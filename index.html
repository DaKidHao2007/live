<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 关键适配配置 -->
  <meta name="referrer" content="unsafe-url">
  <meta http-equiv="Referrer-Policy" content="unsafe-url">
  <title>Live</title>
  <!-- 极简原生CSS，无外部依赖 -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; }
    .container { margin-bottom: 30px; }
    h2 { margin-bottom: 15px; color: #333; font-size: 1.4rem; }
    .player-wrap { width: 100%; aspect-ratio: 16/9; background: #f1f1f1; border-radius: 8px; overflow: hidden; position: relative; }
    .loading { position: absolute; inset: 0; background: rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; display: none; }
    .loading-spin { width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: #165DFF; border-radius: 50%; animation: spin 1s linear infinite; }
    .error { position: absolute; inset: 0; background: #ffebee; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; display: none; }
    .error h3 { color: #b71c1c; margin-bottom: 10px; }
    .error p { color: #7f0000; font-size: 0.9rem; }
    .input-area { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; min-height: 80px; margin-bottom: 15px; font-size: 0.9rem; resize: vertical; }
    .btn-group { display: flex; gap: 10px; }
    button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
    .btn-primary { background: #165DFF; color: white; }
    .btn-default { background: #f5f5f5; color: #333; }
    .tip { background: #fff3cd; padding: 10px 15px; border-radius: 6px; margin-bottom: 20px; font-size: 0.85rem; color: #856404; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <!-- 关键提示 -->
  <div class="tip">
    提示：优先用Firefox浏览器 | 输入YouTube视频ID或嵌入代码 | 视频需开启"允许嵌入"
  </div>

  <!-- 核心播放器区域 -->
  <div class="container">
    <h2>视频播放</h2>
    <div class="player-wrap">
      <iframe id="videoPlayer" 
              width="100%" 
              height="100%" 
              src="https://www.youtube.com/embed/3tmd-ClpJxA" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
              allowfullscreen
              referrerpolicy="unsafe-url"
              sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation allow-presentation">
      </iframe>
      <div class="loading" id="loading">
        <div class="loading-spin"></div>
      </div>
      <div class="error" id="error">
        <h3>播放失败</h3>
        <p>请更换Firefox浏览器或其他允许嵌入的视频</p>
      </div>
    </div>
  </div>

  <!-- 核心输入区域 -->
  <div class="input-area">
    <h2>更换视频</h2>
    <textarea id="videoInput" placeholder="输入YouTube视频ID（如：3tmd-ClpJxA）或完整嵌入代码">3tmd-ClpJxA</textarea>
    <div class="btn-group">
      <button class="btn-primary" id="loadBtn">加载视频</button>
      <button class="btn-default" id="resetBtn">重置</button>
    </div>
  </div>

  <script>
    // 核心DOM元素
    const videoPlayer = document.getElementById('videoPlayer');
    const videoInput = document.getElementById('videoInput');
    const loadBtn = document.getElementById('loadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const defaultVideoId = '3tmd-ClpJxA';

    // 生成适配file协议的嵌入代码
    function generateEmbedCode(input) {
      if (!input.includes('<iframe')) {
        // 输入为视频ID，生成最简代码
        return `
          <iframe width="100%" height="100%" 
                  src="https://www.youtube.com/embed/${input.trim()}" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
                  allowfullscreen
                  referrerpolicy="unsafe-url"
                  sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation allow-presentation">
          </iframe>
        `;
      }
      // 输入为嵌入代码，优化适配
      let code = input.trim();
      code = code.replace('<iframe', '<iframe referrerpolicy="unsafe-url" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation allow-presentation"');
      code = code.replace(/noreferrer/g, '');
      return code;
    }

    // 加载视频
    function loadVideo() {
      const input = videoInput.value.trim();
      if (!input) return;

      loading.style.display = 'flex';
      error.style.display = 'none';

      const embedCode = generateEmbedCode(input);
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = embedCode;
      const newIframe = tempDiv.querySelector('iframe');

      if (newIframe) {
        newIframe.onload = () => {
          loading.style.display = 'none';
          videoPlayer.parentNode.replaceChild(newIframe, videoPlayer);
          videoPlayer = newIframe;
        };
        newIframe.onerror = () => {
          loading.style.display = 'none';
          error.style.display = 'flex';
        };
      } else {
        loading.style.display = 'none';
        error.style.display = 'flex';
      }
    }

    // 重置视频
    function resetVideo() {
      videoInput.value = defaultVideoId;
      const embedCode = generateEmbedCode(defaultVideoId);
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = embedCode;
      const newIframe = tempDiv.querySelector('iframe');
      newIframe.onload = () => loading.style.display = 'none';
      newIframe.onerror = () => error.style.display = 'flex';
      videoPlayer.parentNode.replaceChild(newIframe, videoPlayer);
      videoPlayer = newIframe;
      loading.style.display = 'flex';
      error.style.display = 'none';
    }

    // 事件绑定
    loadBtn.addEventListener('click', loadVideo);
    resetBtn.addEventListener('click', resetVideo);
    videoInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        loadVideo();
      }
    });

    // 初始化错误监听
    videoPlayer.onerror = () => {
      loading.style.display = 'none';
      error.style.display = 'flex';
    };
  </script>
</body>
</html>